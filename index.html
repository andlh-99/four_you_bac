<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4YOU BAC App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Custom styles for animations and font */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark blue background */
            color: #e2e8f0; /* Light text color */
            overflow: hidden; /* Prevent scrolling on main body */
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: linear-gradient(135deg, #1a202c 0%, #2c5282 100%); /* Subtle gradient */
            position: relative;
            overflow: hidden;
        }

        /* Onboarding modal specific styles */
        .onboarding-modal {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
        }

        .onboarding-card {
            background-color: #2d3748; /* Slightly lighter dark blue for cards */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: fadeInScale 0.3s ease-out;
        }

        @keyframes fadeInScale {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Pulsating effect for study timer */
        .pulsating-circle {
            animation: pulse 1.5s infinite ease-in-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(100, 200, 255, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 20px rgba(100, 200, 255, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(100, 200, 255, 0); }
        }

        /* Page transition animation */
        .page {
            display: none; /* Hidden by default */
            animation: slideInFromRight 0.4s ease-out forwards;
        }

        .page.active {
            display: flex; /* Show active page */
        }

        @keyframes slideInFromRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Ranking modal */
        .ranking-modal {
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 999;
        }

        .ranking-card {
            background-color: #2d3748;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        /* Subtle background animation */
        .background-animation {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
        }

        .background-animation::before {
            content: '';
            position: absolute;
            width: 300px;
            height: 300px;
            background: rgba(66, 153, 225, 0.1); /* Blue-500 with transparency */
            border-radius: 50%;
            animation: float1 15s infinite ease-in-out;
            top: 10%;
            left: 5%;
        }

        .background-animation::after {
            content: '';
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(99, 179, 237, 0.15); /* Blue-400 with transparency */
            border-radius: 50%;
            animation: float2 20s infinite ease-in-out;
            bottom: 15%;
            right: 10%;
        }

        @keyframes float1 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(20px, 30px); }
            100% { transform: translate(0, 0); }
        }

        @keyframes float2 {
            0% { transform: translate(0, 0); }
            50% { transform: translate(-30px, -20px); }
            100% { transform: translate(0, 0); }
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="app-container w-full max-w-md mx-auto rounded-xl shadow-2xl relative overflow-hidden">
        <div class="background-animation"></div>

        <div id="onboarding-modal" class="onboarding-modal fixed inset-0 flex items-center justify-center p-4 hidden">
            <div class="onboarding-card relative w-full max-w-sm p-6 rounded-lg text-center flex flex-col items-center">
                <h2 id="onboarding-title" class="text-2xl font-bold mb-4 text-blue-300"></h2>
                <p id="onboarding-description" class="text-gray-300 mb-6"></p>
                <div class="flex justify-center space-x-4 w-full">
                    <button id="onboarding-next-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                        التالي
                    </button>
                    <button id="onboarding-close-btn" class="bg-gray-600 hover:bg-gray-700 text-white font-semibold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg hidden">
                        إغلاق
                    </button>
                </div>
            </div>
        </div>

        <div class="flex-grow w-full p-4 flex flex-col justify-center items-center">
            <div id="home-page" class="page active flex-col items-center justify-center w-full h-full text-center">
                <div class="flex items-center justify-center mb-6">
                    <img id="user-avatar" src="https://placehold.co/100x100/4299e1/ffffff?text=User" alt="صورة المستخدم" class="w-24 h-24 rounded-full border-4 border-blue-400 shadow-lg">
                    <p id="user-name" class="text-3xl font-bold ml-4 text-white">اسم المستخدم</p>
                </div>
                <div class="bg-blue-700 p-8 rounded-full mb-6 shadow-xl pulsating-circle">
                    <p class="text-5xl font-extrabold text-white" id="user-score">0</p>
                    <p class="text-lg text-blue-200">السكور الخاص بك</p>
                </div>
                <div class="flex flex-col space-y-4 w-full max-w-xs">
                    <button id="general-ranking-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                        التصنيف العام
                    </button>
                    <button id="weekly-ranking-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                        التصنيف الأسبوعي
                    </button>
                </div>
            </div>

            <div id="study-page" class="page flex-col items-center justify-center w-full h-full text-center hidden">
                <img src="https://placehold.co/200x200/2a4365/ffffff?text=STUDY" alt="صورة رمزية لشخص يدرس" class="w-48 h-48 rounded-full mb-8 border-4 border-blue-500 shadow-xl">
                <div class="bg-blue-700 p-10 rounded-full mb-8 shadow-xl pulsating-circle">
                    <p id="study-timer" class="text-6xl font-extrabold text-white mb-2">00:00:00</p>
                    <p id="study-score" class="text-2xl text-blue-200">السكور: 0</p>
                </div>
                <button id="start-stop-btn" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-4 px-12 rounded-full transition duration-300 transform hover:scale-105 shadow-lg text-2xl">
                    البداية
                </button>
            </div>

            <div id="unknown-page" class="page flex-col items-center justify-center w-full h-full text-center hidden">
                <i class="fas fa-tools text-blue-400 text-9xl mb-8 animate-bounce"></i>
                <h2 class="text-4xl font-bold text-white mb-4">الصفحة قيد التطوير</h2>
                <p class="text-xl text-gray-300">نحن نعمل بجد لإضافة ميزات جديدة ومثيرة هنا. ترقبوا!</p>
            </div>
        </div>

        <div id="ranking-modal" class="ranking-modal fixed inset-0 flex items-center justify-center p-4 hidden">
            <div class="ranking-card relative w-full max-w-md p-6 rounded-lg text-center flex flex-col items-center">
                <h2 id="ranking-modal-title" class="text-3xl font-bold mb-6 text-blue-300"></h2>
                <div id="top-three-ranking" class="flex justify-around items-end w-full mb-8">
                    <div class="flex flex-col items-center">
                        <img src="https://placehold.co/80x80/63b3ed/ffffff?text=2" alt="Rank 2" class="w-20 h-20 rounded-full border-4 border-gray-400 mb-2 shadow-md">
                        <p class="font-semibold text-gray-200">المركز الثاني</p>
                        <p class="text-lg text-blue-200">اسم 2 (1800)</p>
                    </div>
                    <div class="flex flex-col items-center -mt-8">
                        <img src="https://placehold.co/120x120/4299e1/ffffff?text=1" alt="Rank 1" class="w-32 h-32 rounded-full border-4 border-yellow-400 mb-2 shadow-lg">
                        <p class="font-bold text-xl text-yellow-300">المركز الأول</p>
                        <p class="text-xl text-blue-100">اسم 1 (2500)</p>
                    </div>
                    <div class="flex flex-col items-center">
                        <img src="https://placehold.co/80x80/90cdf4/ffffff?text=3" alt="Rank 3" class="w-20 h-20 rounded-full border-4 border-orange-400 mb-2 shadow-md">
                        <p class="font-semibold text-gray-200">المركز الثالث</p>
                        <p class="text-lg text-blue-200">اسم 3 (1500)</p>
                    </div>
                </div>
                <div id="other-rankings" class="w-full text-left max-h-60 overflow-y-auto pr-2">
                    </div>
                <button id="ranking-close-btn" class="mt-8 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-6 rounded-full transition duration-300 transform hover:scale-105 shadow-lg">
                    إغلاق
                </button>
            </div>
        </div>

        <div class="flex justify-around items-center w-full bg-blue-800 p-4 rounded-t-xl shadow-inner">
            <button id="nav-study-btn" class="nav-btn flex flex-col items-center text-blue-200 hover:text-white transition duration-200">
                <i class="fas fa-book text-2xl mb-1"></i>
                <span class="text-sm">دراسة</span>
            </button>
            <button id="nav-home-btn" class="nav-btn flex flex-col items-center text-white transition duration-200">
                <i class="fas fa-home text-3xl mb-1"></i>
                <span class="text-sm">الرئيسية</span>
            </button>
            <button id="nav-unknown-btn" class="nav-btn flex flex-col items-center text-blue-200 hover:text-white transition duration-200">
                <i class="fas fa-question-circle text-2xl mb-1"></i>
                <span class="text-sm">مجهول</span>
            </button>
        </div>
    </div>

    <script>
        // Check if the user has completed onboarding
        const hasOnboarded = localStorage.getItem('onboarded');
        const onboardingModal = document.getElementById('onboarding-modal');
        const onboardingTitle = document.getElementById('onboarding-title');
        const onboardingDescription = document.getElementById('onboarding-description');
        const onboardingNextBtn = document.getElementById('onboarding-next-btn');
        const onboardingCloseBtn = document.getElementById('onboarding-close-btn');

        const pages = document.querySelectorAll('.page');
        const navHomeBtn = document.getElementById('nav-home-btn');
        const navStudyBtn = document.getElementById('nav-study-btn');
        const navUnknownBtn = document.getElementById('nav-unknown-btn');

        const userScoreDisplay = document.getElementById('user-score');
        const generalRankingBtn = document.getElementById('general-ranking-btn');
        const weeklyRankingBtn = document.getElementById('weekly-ranking-btn');
        const rankingModal = document.getElementById('ranking-modal');
        const rankingModalTitle = document.getElementById('ranking-modal-title');
        const topThreeRanking = document.getElementById('top-three-ranking');
        const otherRankings = document.getElementById('other-rankings');
        const rankingCloseBtn = document.getElementById('ranking-close-btn');

        const studyTimerDisplay = document.getElementById('study-timer');
        const studyScoreDisplay = document.getElementById('study-score');
        const startStopBtn = document.getElementById('start-stop-btn');

        let currentOnboardingStep = 0;
        const onboardingContent = [
            {
                title: 'حساب ترتيبك وتحفيزك',
                description: 'سيتم حساب ترتيبك بناءً على أدائك، مما يحفزك للتقدم أكثر وتحقيق الأفضل. تنافس مع أصدقائك!'
            },
            {
                title: 'ميزات جديدة قريبًا',
                description: 'نحن نعمل باستمرار على إضافة ميزات جديدة ومثيرة لتحسين تجربتك. ترقبوا المزيد من التحديثات الرائعة قريبًا!'
            },
            {
                title: 'الشفافية وتحذير من الغش',
                description: 'تطبيقنا يركز على الشفافية والعدالة. لا نسمح بأي شكل من أشكال الغش لضمان بيئة تنافسية نزيهة للجميع.'
            },
            {
                title: 'مجموعة 4YOU BAC',
                description: 'هذا التطبيق هو جزء من مجموعة "4YOU BAC" المخصصة لمساعدتك في رحلتك التعليمية، من عمل "Askeladd".'
            }
        ];

        let timerInterval;
        let startTime;
        let elapsedTime = 0;
        let isRunning = false;
        let studyScore = 0;
        let userOverallScore = 0; // Dummy user score

        // Dummy ranking data
        const generalRankings = [
            { name: 'اسم 1', score: 2500, avatar: 'https://placehold.co/120x120/4299e1/ffffff?text=1' },
            { name: 'اسم 2', score: 1800, avatar: 'https://placehold.co/80x80/63b3ed/ffffff?text=2' },
            { name: 'اسم 3', score: 1500, avatar: 'https://placehold.co/80x80/90cdf4/ffffff?text=3' },
            { name: 'اسم 4', score: 1200, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=4' },
            { name: 'اسم 5', score: 1100, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=5' },
            { name: 'اسم 6', score: 1000, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=6' },
            { name: 'اسم 7', score: 950, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=7' },
            { name: 'اسم 8', score: 900, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=8' },
            { name: 'اسم 9', score: 850, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=9' },
            { name: 'اسم 10', score: 800, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=10' },
            { name: 'اسم المستخدم', score: userOverallScore, avatar: 'https://placehold.co/50x50/4299e1/ffffff?text=User' } // User's own rank
        ].sort((a, b) => b.score - a.score); // Sort by score descending

        const weeklyRankings = [
            { name: 'اسم أ', score: 700, avatar: 'https://placehold.co/120x120/4299e1/ffffff?text=A' },
            { name: 'اسم ب', score: 650, avatar: 'https://placehold.co/80x80/63b3ed/ffffff?text=B' },
            { name: 'اسم ج', score: 600, avatar: 'https://placehold.co/80x80/90cdf4/ffffff?text=C' },
            { name: 'اسم د', score: 550, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=D' },
            { name: 'اسم هـ', score: 500, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=E' },
            { name: 'اسم و', score: 450, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=F' },
            { name: 'اسم ز', score: 400, avatar: 'https://placehold.co/50x50/a0aec0/ffffff?text=G' },
            { name: 'اسم المستخدم', score: studyScore, avatar: 'https://placehold.co/50x50/4299e1/ffffff?text=User' } // User's own rank
        ].sort((a, b) => b.score - a.score); // Sort by score descending

        /**
         * Hides all pages and sets the active class on the specified page.
         * @param {HTMLElement} pageToShow - The page element to make active.
         */
        function showPage(pageToShow) {
            pages.forEach(page => {
                page.classList.remove('active');
                page.classList.add('hidden');
            });
            pageToShow.classList.remove('hidden');
            pageToShow.classList.add('active');

            // Update navigation button active state
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('text-white');
                btn.classList.add('text-blue-200');
            });
            if (pageToShow.id === 'home-page') {
                navHomeBtn.classList.remove('text-blue-200');
                navHomeBtn.classList.add('text-white');
            } else if (pageToShow.id === 'study-page') {
                navStudyBtn.classList.remove('text-blue-200');
                navStudyBtn.classList.add('text-white');
            } else if (pageToShow.id === 'unknown-page') {
                navUnknownBtn.classList.remove('text-blue-200');
                navUnknownBtn.classList.add('text-white');
            }
        }

        /**
         * Displays the current onboarding step content.
         */
        function displayOnboardingStep() {
            const content = onboardingContent[currentOnboardingStep];
            onboardingTitle.textContent = content.title;
            onboardingDescription.textContent = content.description;

            if (currentOnboardingStep === onboardingContent.length - 1) {
                onboardingNextBtn.classList.add('hidden');
                onboardingCloseBtn.classList.remove('hidden');
            } else {
                onboardingNextBtn.classList.remove('hidden');
                onboardingCloseBtn.classList.add('hidden');
            }
        }

        /**
         * Initializes the onboarding process or skips to home if already onboarded.
         */
        function initializeApp() {
            if (!hasOnboarded) {
                onboardingModal.classList.remove('hidden');
                displayOnboardingStep();
            } else {
                showPage(document.getElementById('home-page'));
            }
            // Initialize dummy user score
            userOverallScore = parseInt(localStorage.getItem('userOverallScore') || '0');
            userScoreDisplay.textContent = userOverallScore;
        }

        /**
         * Handles the "Next" button click for onboarding.
         */
        onboardingNextBtn.addEventListener('click', () => {
            currentOnboardingStep++;
            if (currentOnboardingStep < onboardingContent.length) {
                displayOnboardingStep();
            }
        });

        /**
         * Handles the "Close" button click for onboarding.
         */
        onboardingCloseBtn.addEventListener('click', () => {
            localStorage.setItem('onboarded', 'true');
            onboardingModal.classList.add('hidden');
            showPage(document.getElementById('home-page'));
        });

        // Navigation button event listeners
        navHomeBtn.addEventListener('click', () => showPage(document.getElementById('home-page')));
        navStudyBtn.addEventListener('click', () => showPage(document.getElementById('study-page')));
        navUnknownBtn.addEventListener('click', () => showPage(document.getElementById('unknown-page')));

        /**
         * Formats time in HH:MM:SS.
         * @param {number} seconds - Total seconds.
         * @returns {string} Formatted time string.
         */
        function formatTime(seconds) {
            const h = String(Math.floor(seconds / 3600)).padStart(2, '0');
            const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
            const s = String(seconds % 60).padStart(2, '0');
            return `${h}:${m}:${s}`;
        }

        /**
         * Updates the study timer and score.
         */
        function updateTimer() {
            const now = Date.now();
            elapsedTime += (now - startTime) / 1000; // Add elapsed time in seconds
            startTime = now; // Reset start time for next interval

            studyTimerDisplay.textContent = formatTime(Math.floor(elapsedTime));
            // Update score based on time (e.g., 1 point per 10 seconds)
            studyScore = Math.floor(elapsedTime / 10);
            studyScoreDisplay.textContent = `السكور: ${studyScore}`;
        }

        /**
         * Starts the study timer.
         */
        function startTimer() {
            if (!isRunning) {
                isRunning = true;
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 1000); // Update every second
                startStopBtn.textContent = 'إيقاف';
                startStopBtn.classList.remove('bg-green-500', 'hover:bg-green-600');
                startStopBtn.classList.add('bg-red-500', 'hover:bg-red-600');
            }
        }

        /**
         * Stops the study timer.
         */
        function stopTimer() {
            if (isRunning) {
                isRunning = false;
                clearInterval(timerInterval);
                timerInterval = null;
                startStopBtn.textContent = 'البداية';
                startStopBtn.classList.remove('bg-red-500', 'hover:bg-red-600');
                startStopBtn.classList.add('bg-green-500', 'hover:bg-green-600');

                // Update overall user score
                userOverallScore += studyScore;
                localStorage.setItem('userOverallScore', userOverallScore);
                userScoreDisplay.textContent = userOverallScore;
            }
        }

        /**
         * Toggles the study timer.
         */
        startStopBtn.addEventListener('click', () => {
            if (isRunning) {
                stopTimer();
            } else {
                startTimer();
            }
        });

        // Smart counting: Pause when window loses focus, resume when gains focus
        window.addEventListener('blur', () => {
            if (isRunning) {
                stopTimer(); // Pause timer if app loses focus
            }
        });

        window.addEventListener('focus', () => {
            // No automatic resume here, user must click 'Start' again
            // This is a safer approach for a web app where backgrounding is ambiguous.
            // If automatic resume is desired, store `isRunning` state and resume if it was true.
        });

        /**
         * Populates and displays the ranking modal.
         * @param {Array<Object>} rankingsData - The array of ranking objects.
         * @param {string} title - The title for the modal.
         */
        function displayRankingModal(rankingsData, title) {
            rankingModalTitle.textContent = title;
            topThreeRanking.innerHTML = '';
            otherRankings.innerHTML = '';

            // Ensure rankingsData is sorted for correct top 3
            const sortedRankings = [...rankingsData].sort((a, b) => b.score - a.score);

            // Display top 3
            if (sortedRankings.length > 0) {
                const rank1 = sortedRankings[0];
                topThreeRanking.innerHTML += `
                    <div class="flex flex-col items-center -mt-8">
                        <img src="${rank1.avatar}" alt="المركز الأول" class="w-32 h-32 rounded-full border-4 border-yellow-400 mb-2 shadow-lg">
                        <p class="font-bold text-xl text-yellow-300">المركز الأول</p>
                        <p class="text-xl text-blue-100">${rank1.name} (${rank1.score})</p>
                    </div>
                `;
            }
            if (sortedRankings.length > 1) {
                const rank2 = sortedRankings[1];
                topThreeRanking.innerHTML += `
                    <div class="flex flex-col items-center">
                        <img src="${rank2.avatar}" alt="المركز الثاني" class="w-20 h-20 rounded-full border-4 border-gray-400 mb-2 shadow-md">
                        <p class="font-semibold text-gray-200">المركز الثاني</p>
                        <p class="text-lg text-blue-200">${rank2.name} (${rank2.score})</p>
                    </div>
                `;
            }
            if (sortedRankings.length > 2) {
                const rank3 = sortedRankings[2];
                topThreeRanking.innerHTML += `
                    <div class="flex flex-col items-center">
                        <img src="${rank3.avatar}" alt="المركز الثالث" class="w-20 h-20 rounded-full border-4 border-orange-400 mb-2 shadow-md">
                        <p class="font-semibold text-gray-200">المركز الثالث</p>
                        <p class="text-lg text-blue-200">${rank3.name} (${rank3.score})</p>
                    </div>
                `;
            }

            // Display ranks 4-10
            for (let i = 3; i < Math.min(10, sortedRankings.length); i++) {
                const rank = sortedRankings[i];
                otherRankings.innerHTML += `
                    <div class="flex items-center p-2 rounded-lg mb-2 bg-blue-800">
                        <img src="${rank.avatar}" alt="${rank.name}" class="w-10 h-10 rounded-full mr-3 border-2 border-blue-400">
                        <span class="font-semibold text-white mr-2">${i + 1}.</span>
                        <span class="text-gray-200 flex-grow">${rank.name}</span>
                        <span class="text-blue-100 font-bold">${rank.score}</span>
                    </div>
                `;
            }

            // Display user's own rank if not in top 10
            const userRankIndex = sortedRankings.findIndex(r => r.name === 'اسم المستخدم');
            if (userRankIndex !== -1 && userRankIndex >= 10) {
                const userRank = sortedRankings[userRankIndex];
                otherRankings.innerHTML += `
                    <div class="flex items-center p-2 rounded-lg mt-4 bg-purple-700 border-2 border-purple-400">
                        <img src="${userRank.avatar}" alt="${userRank.name}" class="w-10 h-10 rounded-full mr-3 border-2 border-purple-300">
                        <span class="font-semibold text-white mr-2">${userRankIndex + 1}.</span>
                        <span class="text-gray-100 flex-grow">${userRank.name} (أنت)</span>
                        <span class="text-purple-100 font-bold">${userRank.score}</span>
                    </div>
                `;
            } else if (userRankIndex === -1) {
                 // If user is not in the dummy data, add a placeholder for their rank
                 otherRankings.innerHTML += `
                    <div class="flex items-center p-2 rounded-lg mt-4 bg-purple-700 border-2 border-purple-400">
                        <img src="https://placehold.co/50x50/4299e1/ffffff?text=User" alt="اسم المستخدم" class="w-10 h-10 rounded-full mr-3 border-2 border-purple-300">
                        <span class="font-semibold text-white mr-2">--.</span>
                        <span class="text-gray-100 flex-grow">اسم المستخدم (أنت)</span>
                        <span class="text-purple-100 font-bold">${userOverallScore}</span>
                    </div>
                `;
            }

            rankingModal.classList.remove('hidden');
        }

        generalRankingBtn.addEventListener('click', () => {
            // Update user's score in the generalRankings before displaying
            const userIndex = generalRankings.findIndex(r => r.name === 'اسم المستخدم');
            if (userIndex !== -1) {
                generalRankings[userIndex].score = userOverallScore;
            } else {
                generalRankings.push({ name: 'اسم المستخدم', score: userOverallScore, avatar: 'https://placehold.co/50x50/4299e1/ffffff?text=User' });
            }
            displayRankingModal(generalRankings, 'التصنيف العام');
        });

        weeklyRankingBtn.addEventListener('click', () => {
             // Update user's score in the weeklyRankings before displaying
            const userIndex = weeklyRankings.findIndex(r => r.name === 'اسم المستخدم');
            if (userIndex !== -1) {
                weeklyRankings[userIndex].score = studyScore; // Weekly score is tied to current study session for this demo
            } else {
                weeklyRankings.push({ name: 'اسم المستخدم', score: studyScore, avatar: 'https://placehold.co/50x50/4299e1/ffffff?text=User' });
            }
            displayRankingModal(weeklyRankings, 'التصنيف الأسبوعي');
        });

        rankingCloseBtn.addEventListener('click', () => {
            rankingModal.classList.add('hidden');
        });

        // Initialize the app on window load
        window.onload = initializeApp;
    </script>
</body>
</html>

